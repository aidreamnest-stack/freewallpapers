</style>
</head>
<body>

<!-- ERROR BANNER -->
<div id="errorBanner" class="error-banner" role="alert"></div>

<!-- PRELOADER -->
<div id="preloader">
  <div class="spinner" aria-hidden="true"></div>
  <div class="status">Loading amazing wallpapers...</div>
</div>

<header id="header">
  <div class="header-left">
    <a href="#" class="logo">
      <span class="logo-icon">üé®</span>
      A Dream <span class="logo-sub">4K Premium</span>
    </a>
    <nav aria-label="Main navigation">
      <a href="#" class="active">Home</a>
      <a href="#gallery">Gallery</a>
      <a href="#trending">Trending</a>
      <a href="#collections">Collections</a>
    </nav>
  </div>
  <div class="header-actions">
    <button class="header-btn secondary" id="themeToggle" title="Toggle theme" aria-label="Toggle theme">‚òÄÔ∏è</button>
    <button class="header-btn secondary" id="keyboardShortcuts" title="Keyboard shortcuts">‚å®Ô∏è</button>
    <button class="header-btn" id="favoritesToggle" aria-label="Toggle favorites">
      ‚ù§Ô∏è <span id="favCount">0</span>
    </button>
  </div>
</header>

<section class="hero">
  <h1>Discover Premium Wallpapers</h1>
  <p>Curated collection of 4K & mobile wallpapers. Advanced filters, collections, AI-powered search, and instant downloads.</p>
  
  <div class="hero-stats">
    <div class="hero-stat">
      <div class="hero-stat-number" id="totalWallpapers">0</div>
      <div class="hero-stat-label">Wallpapers</div>
    </div>
    <div class="hero-stat">
      <div class="hero-stat-number" id="totalDownloads">0</div>
      <div class="hero-stat-label">Downloads</div>
    </div>
    <div class="hero-stat">
      <div class="hero-stat-number" id="totalCategories">8</div>
      <div class="hero-stat-label">Categories</div>
    </div>
  </div>
</section>

<!-- Wallpaper of the Day -->
<div class="wotd-banner" id="wotdBanner" style="display:none">
  <div class="wotd-content">
    <div class="wotd-label">üî• Wallpaper of the Day</div>
    <div class="wotd-title" id="wotdTitle">Loading...</div>
    <div class="wotd-desc" id="wotdDesc">Most popular wallpaper today</div>
    <button class="wotd-btn" id="wotdBtn">View Now</button>
  </div>
  <img id="wotdImage" src="" alt="Wallpaper of the day" class="wotd-image">
</div>

<!-- Quick Filters -->
<div class="quick-filters" id="quickFilters">
  <div class="quick-filter-tag active" data-filter="all">All</div>
  <div class="quick-filter-tag" data-filter="featured">‚≠ê Featured</div>
  <div class="quick-filter-tag" data-filter="trending">üî• Trending</div>
  <div class="quick-filter-tag" data-filter="new">‚ú® New</div>
  <div class="quick-filter-tag" data-filter="popular">üëë Popular</div>
</div>

<!-- Advanced Controls -->
<div class="controls-wrapper" role="region" aria-label="Search and filters">
  <div class="controls">
    <input id="searchInput" type="search" placeholder="üîç Search by title, tag, or color..." aria-label="Search wallpapers">
    
    <select id="categorySelect" aria-label="Category filter">
      <option value="">All Categories</option>
      <option value="nature">üå≤ Nature</option>
      <option value="anime">üéå Anime</option>
      <option value="minimal">‚ö™ Minimal</option>
      <option value="abstract">üé® Abstract</option>
      <option value="city">üèôÔ∏è City</option>
      <option value="space">üöÄ Space</option>
      <option value="gaming">üéÆ Gaming</option>
    </select>

    <select id="colorSelect" aria-label="Color filter">
      <option value="">All Colors</option>
      <option value="blue">üîµ Blue</option>
      <option value="pink">ü©∑ Pink</option>
      <option value="green">üü¢ Green</option>
      <option value="orange">üü† Orange</option>
      <option value="purple">üü£ Purple</option>
      <option value="red">üî¥ Red</option>
      <option value="yellow">üü° Yellow</option>
      <option value="black">‚ö´ Black</option>
      <option value="white">‚ö™ White</option>
    </select>

    <select id="resolutionSelect" aria-label="Resolution filter">
      <option value="">All Resolutions</option>
      <option value="4k">4K Ultra HD</option>
      <option value="1080p">1080p Full HD</option>
      <option value="mobile">üì± Mobile</option>
    </select>

    <select id="orientationSelect" aria-label="Orientation filter">
      <option value="">All Orientations</option>
      <option value="landscape">Landscape</option>
      <option value="portrait">Portrait</option>
      <option value="square">Square</option>
    </select>

    <select id="sortSelect" aria-label="Sort by">
      <option value="new">Newest First</option>
      <option value="popular">Most Downloaded</option>
      <option value="trending">Trending</option>
      <option value="random">Random</option>
    </select>

    <button id="searchBtn" aria-label="Apply filters">üîç Search</button>
    <button id="resetBtn" aria-label="Reset filters">üîÑ Reset</button>
  </div>

  <div class="view-controls">
    <span style="color:var(--muted);font-weight:600;font-size:13px">View:</span>
    <button class="view-btn active" data-view="auto">Auto</button>
    <button class="view-btn" data-view="cols-2">2 Columns</button>
    <button class="view-btn" data-view="cols-3">3 Columns</button>
    <button class="view-btn" data-view="cols-4">4 Columns</button>
    <button class="view-btn" data-view="cols-5">5 Columns</button>
    <button class="view-btn" data-view="masonry">Masonry</button>
    <button class="view-btn" data-view="list-view">List</button>
  </div>
</div>

<!-- Stats Section -->
<div class="stats-grid" id="statsGrid">
  <div class="stat-card">
    <div class="stat-card-icon">üìä</div>
    <div class="stat-card-number" id="statViewing">0</div>
    <div class="stat-card-label">Currently Viewing</div>
  </div>
  <div class="stat-card">
    <div class="stat-card-icon">‚≠ê</div>
    <div class="stat-card-number" id="statFeatured">0</div>
    <div class="stat-card-label">Featured Wallpapers</div>
  </div>
  <div class="stat-card">
    <div class="stat-card-icon">üî•</div>
    <div class="stat-card-number" id="statTrending">0</div>
    <div class="stat-card-label">Trending This Week</div>
  </div>
  <div class="stat-card">
    <div class="stat-card-icon">üíæ</div>
    <div class="stat-card-number" id="statDownloaded">0</div>
    <div class="stat-card-label">Total Downloads</div>
  </div>
</div>

<!-- Gallery -->
<div id="trending"></div>
<div class="section-header">
  <h2 class="section-title">All Wallpapers</h2>
  <a href="#" class="section-link" id="shuffleBtn">üîÄ Shuffle</a>
</div>

<div class="container" id="gallery" aria-live="polite">
  <div class="gallery-grid" id="galleryGrid"></div>

  <div class="controls-bottom">
    <button id="loadMoreBtn" class="load-more">Load More Wallpapers</button>
    <button id="infiniteToggle" class="load-more">Enable Infinite Scroll</button>
  </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" aria-hidden="true">
  <button class="lightbox-nav prev" id="lbPrev" aria-label="Previous">‚Äπ</button>
  <button class="lightbox-nav next" id="lbNext" aria-label="Next">‚Ä∫</button>
  
  <div class="lightbox-inner">
    <div class="lightbox-main">
      <img id="lbImage" src="" alt="Preview">
      <div class="lb-meta">
        <h3 id="lbTitle">Title</h3>
        
        <div class="meta-row">
          <span>Category</span>
          <strong id="lbCategory"></strong>
        </div>
        <div class="meta-row">
          <span>Downloads</span>
          <strong id="lbDownloads"></strong>
        </div>
        <div class="meta-row">
          <span>Resolution</span>
          <strong>4K Ultra HD</strong>
        </div>
        
        <div class="tags" id="lbTags"></div>
        
        <div id="lbColorPalette" style="display:flex;gap:8px;margin-top:12px"></div>
        
        <div class="download-controls">
          <label>Download Size</label>
          <select id="sizeSelect">
            <option value="original">Original (4K Ultra HD)</option>
            <option value="1080p">1080p Full HD</option>
            <option value="mobile">Mobile (720p)</option>
          </select>
          
          <div class="btn-group">
            <a id="downloadBtn" class="icon-btn">‚¨á Download</a>
            <button id="shareBtn" class="icon-btn secondary">üîó Share</button>
            <button id="addToCollectionBtn" class="icon-btn secondary">‚ûï Collection</button>
          </div>
        </div>
        
        <div class="similar-section" id="similarSection" style="display:none">
          <h4 style="font-size:16px;margin-bottom:12px;color:var(--text)">Similar Wallpapers</h4>
          <div class="similar-grid" id="similarGrid"></div>
        </div>
      </div>
    </div>
  </div>
  
  <button id="lightboxClose" aria-label="Close">‚úï</button>
</div>

<!-- Favorites Panel -->
<div class="fav-panel" id="favPanel">
  <h4>
    Your Favorites
    <button class="fav-panel-close" id="favPanelClose">‚úï</button>
  </h4>
  <div id="favList"></div>
</div>

<!-- Collections Modal -->
<div class="modal" id="collectionsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add to Collection</h3>
      <button class="modal-close" id="collectionsModalClose">‚úï</button>
    </div>
    <div id="collectionsList"></div>
    <button class="header-btn" id="createCollectionBtn" style="width:100%;margin-top:16px">‚ûï Create New Collection</button>
  </div>
</div>

<!-- Keyboard Shortcuts Modal -->
<div class="modal" id="shortcutsModal">
  <div class="modal-content shortcuts-modal">
    <div class="modal-header">
      <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
      <button class="modal-close" id="shortcutsModalClose">‚úï</button>
    </div>
    <div class="shortcut-item">
      <span>Search</span>
      <span class="shortcut-key">/</span>
    </div>
    <div class="shortcut-item">
      <span>Next Image</span>
      <span class="shortcut-key">‚Üí</span>
    </div>
    <div class="shortcut-item">
      <span>Previous Image</span>
      <span class="shortcut-key">‚Üê</span>
    </div>
    <div class="shortcut-item">
      <span>Close Lightbox</span>
      <span class="shortcut-key">Esc</span>
    </div>
    <div class="shortcut-item">
      <span>Add to Favorites</span>
      <span class="shortcut-key">F</span>
    </div>
    <div class="shortcut-item">
      <span>Download</span>
      <span class="shortcut-key">D</span>
    </div>
    <div class="shortcut-item">
      <span>Random Wallpaper</span>
      <span class="shortcut-key">R</span>
    </div>
    <div class="shortcut-item">
      <span>Toggle Theme</span>
      <span class="shortcut-key">T</span>
    </div>
  </div>
</div>

<!-- Back to top -->
<button id="backToTop" title="Back to top" aria-label="Back to top">‚Üë</button>

<footer style="text-align:center;padding:40px 24px;color:var(--muted);border-top:1px solid var(--border);margin-top:60px">
  <div style="font-family:var(--fancy);font-size:24px;margin-bottom:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));-webkit-background-clip:text;-webkit-text-fill-color:transparent">A Dream Wallpapers</div>
  <p style="font-size:14px;margin-bottom:16px">Premium 4K & Mobile Wallpapers ‚Ä¢ Free Forever</p>
  <div style="display:flex;gap:16px;justify-content:center;flex-wrap:wrap;font-size:13px">
    <a href="#" style="color:var(--muted);text-decoration:none">About</a>
    <a href="#" style="color:var(--muted);text-decoration:none">Privacy</a>
    <a href="#" style="color:var(--muted);text-decoration:none">Terms</a>
    <a href="#" style="color:var(--muted);text-decoration:none">API</a>
    <a href="#" style="color:var(--muted);text-decoration:none">Contact</a>
  </div>
  <small style="display:block;margin-top:20px;opacity:0.6">¬© 2025 A Dream Wallpapers ‚Ä¢ Made with ‚ù§Ô∏è</small>
</footer>

<script>
/* ==========================================
   CONFIGURATION
   ========================================== */
const EXTERNAL_JSON_PATH = './wallpapers.json';
const ITEMS_PER_PAGE = 12;

/* ==========================================
   SAMPLE DATA (Fallback)
   ========================================== */
const INLINE_WALLPAPERS = [
  { id:101, title:'Misty Mountain Peak', category:'nature', tags:['mountain','mist','fog','landscape'], colors:['blue','gray'], sizes:{ original:'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920', '1080p':'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1280', mobile:'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=720' }, downloads: 1245, featured:true, date:'2025-01-20', trending:true },
  { id:102, title:'Cyberpunk City Nights', category:'city', tags:['night','neon','cyberpunk','urban'], colors:['pink','purple','blue'], sizes:{ original:'https://images.unsplash.com/photo-1514565131-fce0801e5785?w=1920', '1080p':'https://images.unsplash.com/photo-1514565131-fce0801e5785?w=1280', mobile:'https://images.unsplash.com/photo-1514565131-fce0801e5785?w=720' }, downloads: 3240, featured:true, date:'2025-01-19', trending:true },
  { id:103, title:'Soft Pastel Waves', category:'minimal', tags:['pastel','soft','abstract','waves'], colors:['pink','purple'], sizes:{ original:'https://images.unsplash.com/photo-1557672172-298e090bd0f1?w=1920', '1080p':'https://images.unsplash.com/photo-1557672172-298e090bd0f1?w=1280', mobile:'https://images.unsplash.com/photo-1557672172-298e090bd0f1?w=720' }, downloads: 892, date:'2025-01-18' },
  { id:104, title:'Enchanted Forest Path', category:'nature', tags:['forest','path','trees','green','magic'], colors:['green'], sizes:{ original:'https://images.unsplash.com/photo-1511497584788-876760111969?w=1920', '1080p':'https://images.unsplash.com/photo-1511497584788-876760111969?w=1280', mobile:'https://images.unsplash.com/photo-1511497584788-876760111969?w=720' }, downloads: 2156, featured:true, date:'2025-01-17', trending:true },
  { id:105, title:'Abstract Liquid Gold', category:'abstract', tags:['vivid','colorful','digital','liquid'], colors:['purple','blue','yellow'], sizes:{ original:'https://images.unsplash.com/photo-1550859492-d5da9d8e45f3?w=1920', '1080p':'https://images.unsplash.com/photo-1550859492-d5da9d8e45f3?w=1280', mobile:'https://images.unsplash.com/photo-1550859492-d5da9d8e45f3?w=720' }, downloads: 1623, date:'2025-01-16' },
  { id:106, title:'Golden Sunset Beach', category:'nature', tags:['sunset','ocean','beach','waves'], colors:['orange','red','yellow'], sizes:{ original:'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1920', '1080p':'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1280', mobile:'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=720' }, downloads: 4521, featured:true, date:'2025-01-15', trending:true },
  { id:107, title:'Deep Space Nebula', category:'space', tags:['galaxy','stars','nebula','cosmos'], colors:['purple','blue','pink'], sizes:{ original:'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?w=1920', '1080p':'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?w=1280', mobile:'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?w=720' }, downloads: 3142, featured:true, date:'2025-01-14', trending:true },
  { id:108, title:'RGB Gaming Paradise', category:'gaming', tags:['rgb','gaming','keyboard','setup'], colors:['red','purple','blue'], sizes:{ original:'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=1920', '1080p':'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=1280', mobile:'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=720' }, downloads: 5234, featured:true, date:'2025-01-13', trending:true },
  { id:109, title:'Sakura Dreams', category:'anime', tags:['anime','sakura','cherry blossom','japan','spring'], colors:['pink'], sizes:{ original:'https://images.unsplash.com/photo-1522383225653-ed111181a951?w=1920', '1080p':'https://images.unsplash.com/photo-1522383225653-ed111181a951?w=1280', mobile:'https://images.unsplash.com/photo-1522383225653-ed111181a951?w=720' }, downloads: 2891, date:'2025-01-12' },
  { id:110, title:'Metropolitan Skyline', category:'city', tags:['city','skyline','buildings','urban','night'], colors:['blue'], sizes:{ original:'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=1920', '1080p':'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=1280', mobile:'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=720' }, downloads: 3567, date:'2025-01-11' },
  { id:111, title:'Minimalist Dark', category:'minimal', tags:['minimal','dark','clean','simple'], colors:['black'], sizes:{ original:'https://images.unsplash.com/photo-1557682250-33bd709cbe85?w=1920', '1080p':'https://images.unsplash.com/photo-1557682250-33bd709cbe85?w=1280', mobile:'https://images.unsplash.com/photo-1557682250-33bd709cbe85?w=720' }, downloads: 1876, date:'2025-01-10' },
  { id:112, title:'Northern Lights Magic', category:'nature', tags:['aurora','northern lights','nature','sky'], colors:['green','blue','purple'], sizes:{ original:'https://images.unsplash.com/photo-1531366936337-7c912a4589a7?w=1920', '1080p':'https://images.unsplash.com/photo-1531366936337-7c912a4589a7?w=1280', mobile:'https://images.unsplash.com/photo-1531366936337-7c912a4589a7?w=720' }, downloads: 2934, featured:true, date:'2025-01-09', trending:true }
];

/* ==========================================
   STATE MANAGEMENT
   ========================================== */
let WALLPAPERS = [];
const state = {
  filtered: [],
  visibleCount: ITEMS_PER_PAGE,
  infinite: false,
  currentIndex: 0,
  isLoading: false,
  jsonLoaded: false,
  currentView: 'auto',
  currentFilters: {
    search: '',
    category: '',
    color: '',
    resolution: '',
    orientation: '',
    sort: 'new',
    quickFilter: 'all'
  },
  collections: [],
  currentLightboxId: null
};

/* ==========================================
   UTILITIES
   ========================================== */
const $ = sel => document.querySelector(sel);
const $ = sel => Array.from(document.querySelectorAll(sel));
const escapeHtml = text => {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
};

/* ==========================================
   DATA LOADING
   ========================================== */
async function loadWallpapersJSON(){
  const preloader = $('#preloader');
  const statusEl = preloader?.querySelector('.status');
  
  try{
    if(statusEl) statusEl.textContent = 'Fetching wallpapers from JSON...';
    
    const res = await fetch(EXTERNAL_JSON_PATH, {
      cache:'no-store',
      headers: { 'Content-Type': 'application/json' }
    });
    
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    
    const data = await res.json();
    
    if(!Array.isArray(data) || data.length === 0){
      throw new Error('Invalid JSON data');
    }
    
    const valid = data.filter(i => i.id && i.title && i.sizes?.original);
    
    if(valid.length === 0) throw new Error('No valid wallpapers');
    
    WALLPAPERS = valid;
    state.jsonLoaded = true;
    console.log(`‚úÖ Loaded ${WALLPAPERS.length} wallpapers from JSON`);
    
  } catch(err){
    console.warn('‚ö†Ô∏è JSON load failed:', err.message);
    console.log('üì¶ Using fallback data');
    WALLPAPERS = INLINE_WALLPAPERS.slice();
    showError(`Demo mode: Place wallpapers.json at ${EXTERNAL_JSON_PATH}`);
  } finally {
    state.filtered = WALLPAPERS.slice();
    init();
    hidePreloader();
  }
}

function hidePreloader(){
  const p = $('#preloader');
  if(p){
    setTimeout(() => {
      p.style.opacity = '0';
      setTimeout(() => p.style.display = 'none', 300);
    }, 600);
  }
}

function showError(msg){
  const banner = $('#errorBanner');
  if(banner){
    banner.textContent = msg;
    banner.classList.add('show');
    setTimeout(() => banner.classList.remove('show'), 5000);
  }
}

function toast(msg, type = 'default', duration = 2500){
  const existing = $('.toast');
  if(existing) existing.remove();
  
  const d = document.createElement('div');
  d.className = `toast ${type}`;
  d.textContent = msg;
  document.body.appendChild(d);
  setTimeout(() => d.remove(), duration);
}

/* ==========================================
   STATS & WALLPAPER OF THE DAY
   ========================================== */
function updateStats(){
  const total = WALLPAPERS.length;
  const featured = WALLPAPERS.filter(w => w.featured).length;
  const trending = WALLPAPERS.filter(w => w.trending).length;
  const totalDL = WALLPAPERS.reduce((sum, w) => sum + (w.downloads || 0), 0);
  
  $('#totalWallpapers').textContent = total;
  $('#totalDownloads').textContent = totalDL.toLocaleString();
  $('#statViewing').textContent = state.filtered.length;
  $('#statFeatured').textContent = featured;
  $('#statTrending').textContent = trending;
  $('#statDownloaded').textContent = totalDL.toLocaleString();
}

function showWallpaperOfTheDay(){
  const wotd = WALLPAPERS.filter(w => w.featured).sort((a,b) => (b.downloads || 0) - (a.downloads || 0))[0];
  
  if(!wotd) return;
  
  const banner = $('#wotdBanner');
  if(banner){
    $('#wotdTitle').textContent = wotd.title;
    $('#wotdDesc').textContent = `${wotd.category} ‚Ä¢ ${(wotd.downloads || 0).toLocaleString()} downloads`;
    $('#wotdImage').src = wotd.sizes['1080p'] || wotd.sizes.original;
    $('#wotdBtn').onclick = () => openLightboxById(wotd.id);
    banner.style.display = 'flex';
  }
}

/* ==========================================
   FILTERS & SEARCH
   ========================================== */
function applyFilters(){
  const {search, category, color, resolution, orientation, sort, quickFilter} = state.currentFilters;
  
  state.filtered = WALLPAPERS.filter(w => {
    const matchSearch = !search || 
      w.title.toLowerCase().includes(search) ||
      (w.tags && w.tags.some(t => t.toLowerCase().includes(search)));
    
    const matchCat = !category || w.category === category;
    const matchColor = !color || (w.colors && w.colors.includes(color));
    const matchQuick = quickFilter === 'all' ||
      (quickFilter === 'featured' && w.featured) ||
      (quickFilter === 'trending' && w.trending) ||
      (quickFilter === 'new' && isNew(w)) ||
      (quickFilter === 'popular' && (w.downloads || 0) > 2000);
    
    return matchSearch && matchCat && matchColor && matchQuick;
  });
  
  // Sort
  if(sort === 'popular') state.filtered.sort((a,b) => (b.downloads || 0) - (a.downloads || 0));
  else if(sort === 'trending') state.filtered.sort((a,b) => (b.trending ? 1 : 0) - (a.trending ? 1 : 0));
  else if(sort === 'random') state.filtered.sort(() => Math.random() - 0.5);
  else state.filtered.sort((a,b) => (b.date || '').localeCompare(a.date || ''));
  
  state.visibleCount = Math.min(ITEMS_PER_PAGE, state.filtered.length);
  renderGallery(true);
  updateStats();
  
  $('#gallery')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function isNew(w){
  if(!w.date) return false;
  const days = Math.floor((Date.now() - new Date(w.date)) / (1000*60*60*24));
  return days <= 7;
}

function resetFilters(){
  state.currentFilters = {
    search: '',
    category: '',
    color: '',
    resolution: '',
    orientation: '',
    sort: 'new',
    quickFilter: 'all'
  };
  
  $('#searchInput').value = '';
  $('#categorySelect').value = '';
  $('#colorSelect').value = '';
  $('#resolutionSelect').value = '';
  $('#orientationSelect').value = '';
  $('#sortSelect').value = 'new';
  
  $('.quick-filter-tag').forEach(t => t.classList.remove('active'));
  $('.quick-filter-tag[data-filter="all"]')?.classList.add('active');
  
  applyFilters();
  toast('‚úÖ Filters reset', 'success');
}

// Event Listeners
$('#searchBtn')?.addEventListener('click', applyFilters);
$('#searchInput')?.addEventListener('keyup', e => {
  if(e.key === 'Enter') applyFilters();
  state.currentFilters.search = e.target.value.trim().toLowerCase();
});
$('#categorySelect')?.addEventListener('change', e => {
  state.currentFilters.category = e.target.value;
  applyFilters();
});
$('#colorSelect')?.addEventListener('change', e => {
  state.currentFilters.color = e.target.value;
  applyFilters();
});
$('#resolutionSelect')?.addEventListener('change', e => {
  state.currentFilters.resolution = e.target.value;
  applyFilters();
});
$('#orientationSelect')?.addEventListener('change', e => {
  state.currentFilters.orientation = e.target.value;
  applyFilters();
});
$('#sortSelect')?.addEventListener('change', e => {
  state.currentFilters.sort = e.target.value;
  applyFilters();
});
$('#resetBtn')?.addEventListener('click', resetFilters);

// Quick Filters
$('.quick-filter-tag').forEach(tag => {
  tag.addEventListener('click', () => {
    $('.quick-filter-tag').forEach(t => t.classList.remove('active'));
    tag.classList.add('active');
    state.currentFilters.quickFilter = tag.dataset.filter;
    applyFilters();
  });
});

// Shuffle
$('#shuffleBtn')?.addEventListener('click', (e) => {
  e.preventDefault();
  state.currentFilters.sort = 'random';
  $('#sortSelect').value = 'random';
  applyFilters();
  toast('üîÄ Shuffled!', 'success');
});

/* ==========================================
   RENDER GALLERY
   ========================================== */
function renderGallery(reset = true){
  const grid = $('#galleryGrid');
  if(!grid) return;
  
  if(reset){
    grid.innerHTML = '';
    state.visibleCount = Math.min(ITEMS_PER_PAGE, state.filtered.length);
  }
  
  if(state.filtered.length === 0){
    grid.innerHTML = `
      <div class="empty-state">
        <h3>No wallpapers found</h3>
        <p>Try adjusting your filters or search terms</p>
        <button class="header-btn" onclick="resetFilters()" style="margin-top:20px">üîÑ Reset Filters</button>
      </div>`;
    $('#loadMoreBtn').style.display = 'none';
    return;
  }
  
  const slice = state.filtered.slice(0, state.visibleCount);
  
  if(!reset){
    const oldCount = grid.children.length;
    for(let i = oldCount; i < slice.length; i++){
      grid.appendChild(createCard(slice[i]));
    }
  } else {
    slice.forEach(item => grid.appendChild(createCard(item)));
  }
  
  lazyLoad();
  updateLoadMoreBtn();
  updateStats();
}

function createCard(item){
  const card = document.createElement('div');
  card.className = `card ${state.currentView === 'list-view' ? 'list-view' : ''}`;
  
  const isFav = getFavorites().includes(item.id);
  const heartIcon = isFav ? '‚ô•' : '‚ô°';
  
  const colorPalette = item.colors ? item.colors.map(c => 
    `<div class="color-swatch" style="background:${c}" title="${c}"></div>`
  ).join('') : '';
  
  card.innerHTML = `
    <div style="position:relative">
      <a href="#" class="preview" data-id="${item.id}" aria-label="Open ${escapeHtml(item.title)}">
        <img data-src="${item.sizes['1080p'] || item.sizes.original}" alt="${escapeHtml(item.title)}" loading="lazy" />
      </a>
      <div class="card-overlay"></div>
      <button class="fav ${isFav ? 'active' : ''}" data-id="${item.id}" title="Add to favorites" aria-label="Toggle favorite">${heartIcon}</button>
      ${item.featured ? '<div class="featured-badge">Featured</div>' : ''}
      <div class="meta">
        <span>${escapeHtml(item.category)}</span>
        <span>‚Ä¢</span>
        <span>${(item.downloads || 0).toLocaleString()}‚Üì</span>
      </div>
      <div class="info-overlay">
        <h3>${escapeHtml(item.title)}</h3>
        <div class="tags">${item.tags ? item.tags.slice(0, 3).map(t => '#' + t).join(' ') : ''}</div>
      </div>
      <div class="color-palette">${colorPalette}</div>
      <div class="actions">
        <button class="icon-btn download-mini" data-id="${item.id}" aria-label="Quick download" title="Quick download">‚¨á</button>
        <button class="icon-btn share-mini" data-id="${item.id}" aria-label="Share" title="Share">üîó</button>
      </div>
    </div>`;
  
  const preview = card.querySelector('.preview');
  preview.addEventListener('click', e => {
    e.preventDefault();
    openLightboxById(item.id);
  });
  
  const favBtn = card.querySelector('.fav');
  favBtn.addEventListener('click', e => {
    e.stopPropagation();
    toggleFavorite(item.id);
    favBtn.textContent = getFavorites().includes(item.id) ? '‚ô•' : '‚ô°';
    favBtn.classList.toggle('active');
    updateFavUI();
  });
  
  const downloadBtn = card.querySelector('.download-mini');
  downloadBtn.addEventListener('click', e => {
    e.stopPropagation();
    handleQuickDownload(item.id);
  });
  
  const shareBtn = card.querySelector('.share-mini');
  shareBtn.addEventListener('click', e => {
    e.stopPropagation();
    openShareDialog(item);
  });
  
  return card;
}

function updateLoadMoreBtn(){
  const btn = $('#loadMoreBtn');
  if(!btn) return;
  
  if(state.visibleCount >= state.filtered.length){
    btn.style.display = 'none';
  } else {
    btn.style.display = 'block';
    btn.textContent = `Load More (${state.filtered.length - state.visibleCount} remaining)`;
  }
}

/* ==========================================
   VIEW CONTROLS
   ========================================== */
$('.view-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    $('.view-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    const view = btn.dataset.view;
    state.currentView = view;
    
    const grid = $('#galleryGrid');
    if(!grid) return;
    
    grid.className = 'gallery-grid';
    if(view !== 'auto') grid.classList.add(view);
    
    // Re-render for list view
    if(view === 'list-view' || state.currentView === 'list-view'){
      renderGallery(true);
    }
  });
});

/* ==========================================
   LAZY LOADING
   ========================================== */
function lazyLoad(){
  const imgs = $('img[data-src]');
  
  if('IntersectionObserver' in window){
    const obs = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          const img = entry.target;
          img.src = img.dataset.src;
          img.removeAttribute('data-src');
          observer.unobserve(img);
        }
      });
    }, {rootMargin:'100px'});
    
    imgs.forEach(img => obs.observe(img));
  } else {
    imgs.forEach(img => {
      img.src = img.dataset.src;
      img.removeAttribute('data-src');
    });
  }
}

/* ==========================================
   LOAD MORE & INFINITE SCROLL
   ========================================== */
$('#loadMoreBtn')?.addEventListener('click', () => {
  const prevCount = state.visibleCount;
  state.visibleCount = Math.min(state.visibleCount + ITEMS_PER_PAGE, state.filtered.length);
  
  if(state.visibleCount > prevCount){
    renderGallery(false);
  }
});

$('#infiniteToggle')?.addEventListener('click', () => {
  state.infinite = !state.infinite;
  const btn = $('#infiniteToggle');
  if(btn){
    btn.textContent = state.infinite ? '‚è∏ Disable Infinite Scroll' : '‚ñ∂ Enable Infinite Scroll';
    toast(state.infinite ? '‚ôæÔ∏è Infinite scroll enabled' : '‚è∏ Infinite scroll disabled', 'success');
  }
});

let scrollTimeout;
window.addEventListener('scroll', () => {
  // Infinite scroll
  if(state.infinite && !state.isLoading){
    const scrollPosition = window.innerHeight + window.scrollY;
    const threshold = document.body.offsetHeight - 400;
    
    if(scrollPosition >= threshold && state.visibleCount < state.filtered.length){
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        state.visibleCount = Math.min(state.visibleCount + ITEMS_PER_PAGE, state.filtered.length);
        renderGallery(false);
      }, 200);
    }
  }
  
  // Back to top
  const backBtn = $('#backToTop');
  if(backBtn){
    backBtn.style.display = window.scrollY > 600 ? 'block' : 'none';
  }
  
  // Header scroll effect
  const header = $('#header');
  if(header){
    if(window.scrollY > 50){
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }
  }
});

$('#backToTop')?.addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

/* ==========================================
   LIGHTBOX
   ========================================== */
const lightbox = $('#lightbox');

function openLightboxById(id){
  const idx = state.filtered.findIndex(x => x.id === id);
  if(idx === -1) return;
  state.currentIndex = idx;
  state.currentLightboxId = id;
  showLightbox(state.filtered[idx]);
}

function showLightbox(obj){
  if(!lightbox) return;
  
  $('#lbImage').src = obj.sizes.original;
  $('#lbImage').alt = obj.title;
  $('#lbTitle').textContent = obj.title;
  $('#lbCategory').textContent = obj.category;
  $('#lbDownloads').textContent = (obj.downloads || 0).toLocaleString();
  
  // Tags
  const tagsEl = $('#lbTags');
  if(tagsEl){
    tagsEl.innerHTML = obj.tags ? 
      obj.tags.map(tag => `<span class="lb-tag">#${escapeHtml(tag)}</span>`).join('') : 
      '';
  }
  
  // Color palette
  const paletteEl = $('#lbColorPalette');
  if(paletteEl && obj.colors){
    paletteEl.innerHTML = obj.colors.map(c => 
      `<div style="width:32px;height:32px;border-radius:8px;background:${c};border:2px solid var(--border);cursor:pointer" title="${c}"></div>`
    ).join('');
  }
  
  // Download button
  $('#sizeSelect').value = 'original';
  $('#downloadBtn').onclick = () => {
    const size = $('#sizeSelect')?.value || 'original';
    const url = obj.sizes[size] || obj.sizes.original;
    triggerDownload(url, `${obj.title.replace(/\s+/g,'_')}_${size}.jpg`);
    obj.downloads = (obj.downloads || 0) + 1;
    $('#lbDownloads').textContent = obj.downloads.toLocaleString();
    toast('‚¨á Download started!', 'success');
  });
  
  // Share button
  $('#shareBtn').onclick = () => openShareDialog(obj);
  
  // Add to collection
  $('#addToCollectionBtn').onclick = () => {
    state.currentLightboxId = obj.id;
    showCollectionsModal();
  };
  
  // Similar wallpapers
  showSimilarWallpapers(obj);
  
  lightbox.classList.add('show');
  lightbox.setAttribute('aria-hidden', 'false');
  document.body.style.overflow = 'hidden';
}

function showSimilarWallpapers(obj){
  const similar = WALLPAPERS
    .filter(w => w.id !== obj.id && w.category === obj.category)
    .slice(0, 6);
  
  const section = $('#similarSection');
  const grid = $('#similarGrid');
  
  if(similar.length === 0 || !section || !grid){
    if(section) section.style.display = 'none';
    return;
  }
  
  section.style.display = 'block';
  grid.innerHTML = similar.map(w => 
    `<div class="similar-item" onclick="openLightboxById(${w.id})">
      <img src="${w.sizes['1080p'] || w.sizes.original}" alt="${escapeHtml(w.title)}">
    </div>`
  ).join('');
}

function closeLightbox(){
  if(!lightbox) return;
  lightbox.classList.remove('show');
  lightbox.setAttribute('aria-hidden', 'true');
  $('#lbImage').src = '';
  document.body.style.overflow = '';
  state.currentLightboxId = null;
}

$('#lightboxClose')?.addEventListener('click', closeLightbox);

$('#lbPrev')?.addEventListener('click', () => navigate(-1));
$('#lbNext')?.addEventListener('click', () => navigate(1));

lightbox?.addEventListener('click', e => {
  if(e.target === lightbox) closeLightbox();
});

function navigate(dir){
  let i = state.currentIndex + dir;
  if(i < 0) i = state.filtered.length - 1;
  if(i >= state.filtered.length) i = 0;
  state.currentIndex = i;
  showLightbox(state.filtered[i]);
}

/* ==========================================
   KEYBOARD SHORTCUTS
   ========================================== */
document.addEventListener('keydown', e => {
  // Lightbox navigation
  if(lightbox?.classList.contains('show')){
    if(e.key === 'Escape') closeLightbox();
    if(e.key === 'ArrowRight') navigate(1);
    if(e.key === 'ArrowLeft') navigate(-1);
    if(e.key === 'd' || e.key === 'D'){
      e.preventDefault();
      $('#downloadBtn')?.click();
    }
    if(e.key === 'f' || e.key === 'F'){
      e.preventDefault();
      if(state.currentLightboxId){
        toggleFavorite(state.currentLightboxId);
        toast('‚ù§Ô∏è Favorite toggled', 'success');
      }
    }
    return;
  }
  
  // Global shortcuts
  if(e.key === '/' || (e.key === 'k' && (e.metaKey || e.ctrlKey))){
    e.preventDefault();
    $('#searchInput')?.focus();
  }
  
  if(e.key === 'r' || e.key === 'R'){
    if(document.activeElement?.tagName !== 'INPUT'){
      e.preventDefault();
      const random = state.filtered[Math.floor(Math.random() * state.filtered.length)];
      if(random) openLightboxById(random.id);
    }
  }
  
  if(e.key === 't' || e.key === 'T'){
    if(document.activeElement?.tagName !== 'INPUT'){
      e.preventDefault();
      $('#themeToggle')?.click();
    }
  }
  
  if(e.key === 'Escape'){
    closeModal('shortcutsModal');
    closeModal('collectionsModal');
    const favPanel = $('#favPanel');
    if(favPanel?.classList.contains('show')){
      favPanel.classList.remove('show');
    }
  }
});

$('#keyboardShortcuts')?.addEventListener('click', () => {
  showModal('shortcutsModal');
});

/* ==========================================
   DOWNLOAD & SHARE
   ========================================== */
function triggerDownload(url, filename){
  const a = document.createElement('a');
  a.href = url;
  a.download = filename || 'wallpaper.jpg';
  a.target = '_blank';
  document.body.appendChild(a);
  a.click();
  setTimeout(() => a.remove(), 100);
}

function handleQuickDownload(id){
  const obj = WALLPAPERS.find(x => x.id === id);
  if(!obj) return;
  
  triggerDownload(obj.sizes.original, obj.title.replace(/\s+/g,'_') + '.jpg');
  obj.downloads = (obj.downloads || 0) + 1;
  renderGallery(false);
  toast('‚¨á Download started!', 'success');
}

function openShareDialog(obj){
  if(navigator.share){
    navigator.share({
      title: obj.title,
      text: `${obj.title} ‚Äî A Dream Wallpapers`,
      url: window.location.href + '#wallpaper-' + obj.id
    }).catch(() => {});
  } else {
    const url = encodeURIComponent(window.location.href + '#wallpaper-' + obj.id);
    const text = encodeURIComponent(`${obj.title} ‚Ä¢ A Dream Wallpapers`);
    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank', 'width=550,height=420');
  }
  toast('üîó Share link copied!', 'success');
}

/* ==========================================
   FAVORITES
   ========================================== */
function getFavorites(){
  try {
    return JSON.parse(localStorage.getItem('adw_favs') || '[]');
  } catch {
    return [];
  }
}

function setFavorites(arr){
  try {
    localStorage.setItem('adw_favs', JSON.stringify(arr));
    updateFavUI();
  } catch(e) {
    console.error('Failed to save favorites:', e);
  }
}

function toggleFavorite(id){
  const favs = getFavorites();
  if(favs.includes(id)){
    setFavorites(favs.filter(x => x !== id));
    toast('üíî Removed from favorites', 'default');
  } else {
    favs.push(id);
    setFavorites(favs);
    toast('‚ù§Ô∏è Added to favorites', 'success');
  }
  renderGallery(false);
}

function updateFavUI(){
  const list = $('#favList');
  const favCount = $('#favCount');
  if(!list) return;
  
  list.innerHTML = '';
  const favs = getFavorites();
  
  if(favCount) favCount.textContent = favs.length;
  
  if(favs.length === 0){
    list.innerHTML = '<p style="color:var(--muted);font-size:14px;text-align:center;padding:40px 20px">No favorites yet<br>‚ù§Ô∏è Click the heart icon on any wallpaper</p>';
    return;
  }
  
  favs.slice().reverse().forEach(id => {
    const obj = WALLPAPERS.find(x => x.id === id);
    if(!obj) return;
    
    const node = document.createElement('div');
    node.className = 'fav-item';
    node.innerHTML = `
      <img src="${obj.sizes['1080p'] || obj.sizes.original}" alt="${escapeHtml(obj.title)}">
      <div class="fav-item-info">
        <div class="fav-item-title">${escapeHtml(obj.title)}</div>
        <div class="fav-item-cat">${escapeHtml(obj.category)}</div>
      </div>
      <div class="fav-item-actions">
        <button onclick="openLightboxById(${obj.id})">View</button>
        <button onclick="removeFav(${obj.id})">Remove</button>
      </div>`;
    list.appendChild(node);
  });
}

function removeFav(id){
  const arr = getFavorites();
  setFavorites(arr.filter(x => x !== id));
  renderGallery(false);
  toast('üíî Removed from favorites', 'default');
}

$('#favoritesToggle')?.addEventListener('click', () => {
  const panel = $('#favPanel');
  if(!panel) return;
  panel.classList.toggle('show');
  updateFavUI();
});

$('#favPanelClose')?.addEventListener('click', () => {
  $('#favPanel')?.classList.remove('show');
});

/* ==========================================
   COLLECTIONS
   ========================================== */
function getCollections(){
  try {
    return JSON.parse(localStorage.getItem('adw_collections') || '[]');
  } catch {
    return [];
  }
}

function setCollections(arr){
  try {
    localStorage.setItem('adw_collections', JSON.stringify(arr));
  } catch(e) {
    console.error('Failed to save collections:', e);
  }
}

function showCollectionsModal(){
  const modal = $('#collectionsModal');
  const list = $('#collectionsList');
  if(!modal || !list) return;
  
  const collections = getCollections();
  
  if(collections.length === 0){
    list.innerHTML = '<p style="text-align:center;color:var(--muted);padding:20px">No collections yet. Create your first one!</p>';
  } else {
    list.innerHTML = '<div class="collection-grid">' + collections.map((col, idx) => `
      <div class="collection-item" onclick="addToCollection(${idx})">
        <div>
          <div class="collection-name">${escapeHtml(col.name)}</div>
          <div class="collection-count">${col.items.length} wallpapers</div>
        </div>
        <div>‚ûï</div>
      </div>
    `).join('') + '</div>';
  }
  
  showModal('collectionsModal');
}

function addToCollection(idx){
  if(!state.currentLightboxId) return;
  
  const collections = getCollections();
  if(!collections[idx].items.includes(state.currentLightboxId)){
    collections[idx].items.push(state.currentLightboxId);
    setCollections(collections);
    toast(`‚úÖ Added to "${collections[idx].name}"`, 'success');
  } else {
    toast('Already in this collection', 'default');
  }
  
  closeModal('collectionsModal');
}

$('#createCollectionBtn')?.addEventListener('click', () => {
  const name = prompt('Collection name:');
  if(!name || !name.trim()) return;
  
  const collections = getCollections();
  collections.push({
    name: name.trim(),
    items: state.currentLightboxId ? [state.currentLightboxId] : [],
    created: new Date().toISOString()
  });
  setCollections(collections);
  
  toast(`‚úÖ Collection "${name}" created!`, 'success');
  showCollectionsModal();
});

/* ==========================================
   MODALS
   ========================================== */
function showModal(id){
  $(`#${id}`)?.classList.add('show');
}

function closeModal(id){
  $(`#${id}`)?.classList.remove('show');
}

$('#collectionsModalClose')?.addEventListener('click', () => closeModal('collectionsModal'));
$('#shortcutsModalClose')?.addEventListener('click', () => closeModal('shortcutsModal'));

$('.modal').forEach(modal => {
  modal.addEventListener('click', e => {
    if(e.target === modal) modal.classList.remove('show');
  });
});

/* ==========================================
   THEME TOGGLE
   ========================================== */
function applyTheme(isLight){
  if(isLight){
    document.body.classList.add('light');
  } else {
    document.body.classList.remove('light');
  }
  
  try {
    localStorage.setItem('adw_theme', isLight ? 'light' : 'dark');
  } catch(e) {
    console.error('Failed to save theme:', e);
  }
  
  const toggle = $('#themeToggle');
  if(toggle) toggle.textContent = isLight ? 'üåô' : '‚òÄÔ∏è';
}

$('#themeToggle')?.addEventListener('click', () => {
  const isLight = document.body.classList.toggle('light');
  applyTheme(isLight);
});

// Load saved theme
(function loadTheme(){
  try {
    const savedTheme = localStorage.getItem('adw_theme');
    applyTheme(savedTheme === 'light');
  } catch {
    applyTheme(false);
  }
})();

/* ==========================================
   INITIALIZATION
   ========================================== */
function init(){
  if(!WALLPAPERS || WALLPAPERS.length === 0){
    WALLPAPERS = INLINE_WALLPAPERS.slice();
  }
  
  state.filtered = WALLPAPERS.slice();
  renderGallery(true);
  updateFavUI();
  updateStats();
  showWallpaperOfTheDay();
  
  console.log('üé® A Dream Wallpapers Ultimate Edition');
  console.log(`üìä ${WALLPAPERS.length} wallpapers loaded`);
  console.log(`üîó Source: ${state.jsonLoaded ? 'External JSON' : 'Fallback data'}`);
}

// Start
loadWallpapersJSON();

</script>
</body>
</html><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>A Dream Wallpapers ‚Äî 4K & Mobile | Premium Quality</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Pacifico&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<meta name="description" content="A Dream Wallpapers ‚Äî Discover premium 4K & mobile wallpapers. Advanced filters, collections, AI-powered search, and more.">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#ffb400">

<style>
:root{
  --bg:#06060a; --surface:#0f1115; --surface-2:#16171d; --muted:#a9a9b0; --accent:#ffb400; --accent-2:#ff6a88;
  --glass: rgba(255,255,255,0.04); --text:#f5f5f7; --card-shadow: 0 8px 30px rgba(0,0,0,0.6);
  --fancy: "Playfair Display", serif; --ui: "Inter", "Poppins", system-ui; --success:#4ade80; --error:#ef4444;
  --border: rgba(255,255,255,0.06); --hover: rgba(255,255,255,0.08);
}
body.light {
  --bg:#fafafa; --surface:#ffffff; --surface-2:#f5f5f5; --muted:#6b7280; --text:#111827; 
  --glass: rgba(0,0,0,0.02); --card-shadow: 0 4px 20px rgba(0,0,0,0.08); --border: rgba(0,0,0,0.08); --hover: rgba(0,0,0,0.04);
}

*{box-sizing:border-box; margin:0; padding:0}
html,body{height:100%; scroll-behavior:smooth}
body{
  font-family:var(--ui); background:var(--bg); color:var(--text);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  transition: background .3s ease, color .3s ease; overflow-x:hidden;
}

/* Scrollbar */
::-webkit-scrollbar{width:10px; height:10px}
::-webkit-scrollbar-track{background:var(--surface)}
::-webkit-scrollbar-thumb{background:var(--muted); border-radius:5px}
::-webkit-scrollbar-thumb:hover{background:var(--accent)}

/* Selection */
::selection{background:var(--accent); color:#000}

/* Animations */
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes slideUp{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
@keyframes slideDown{from{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}

/* PRELOADER */
#preloader{position:fixed; inset:0; display:flex;align-items:center;justify-content:center;background:var(--bg);z-index:99999;flex-direction:column;gap:20px}
#preloader .spinner{width:64px;height:64px;border-radius:50%;border:6px solid var(--border);border-top:6px solid var(--accent);animation:spin 0.9s linear infinite}
#preloader .status{color:var(--muted);font-size:14px;font-weight:600;animation:pulse 2s ease-in-out infinite}

/* HEADER */
header{
  position:sticky; top:0; z-index:998; display:flex; justify-content:space-between; align-items:center;
  gap:16px; padding:14px 24px; background:rgba(6,6,10,0.8); backdrop-filter: blur(20px);
  border-bottom:1px solid var(--border); transition:all .3s;
}
body.light header{background:rgba(255,255,255,0.9)}
header.scrolled{padding:10px 24px; box-shadow:var(--card-shadow)}

.logo{font-family:'Pacifico',cursive; font-size:26px; letter-spacing:0.3px; color:var(--text); text-decoration:none; display:flex; align-items:center; gap:10px}
.logo-icon{width:32px; height:32px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:18px}
.logo-sub{font-family:var(--ui); font-weight:500; margin-left:4px; font-size:11px; color:var(--muted); background:var(--surface); padding:3px 8px; border-radius:6px}

.header-left{display:flex; align-items:center; gap:16px; flex-wrap:wrap}
nav{display:flex; gap:4px; flex-wrap:wrap}
nav a{color:var(--muted); padding:8px 12px; font-weight:600; font-size:14px; text-decoration:none; transition:all .2s; border-radius:8px; position:relative}
nav a:hover{color:var(--text); background:var(--hover)}
nav a.active{color:var(--accent)}
nav a.active::after{content:''; position:absolute; bottom:0; left:50%; transform:translateX(-50%); width:20px; height:2px; background:var(--accent); border-radius:2px}

.header-actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
.header-btn{padding:10px 16px; border-radius:10px; background:var(--accent); color:#000; font-weight:700; border:none; cursor:pointer; transition:all .2s; font-size:14px; font-family:var(--ui); display:flex; align-items:center; gap:6px; white-space:nowrap}
.header-btn:hover{transform:translateY(-2px); box-shadow:0 8px 24px rgba(255,180,0,0.3)}
.header-btn:active{transform:translateY(0)}
.header-btn.secondary{background:var(--surface); color:var(--text); border:1px solid var(--border)}
.header-btn.secondary:hover{background:var(--surface-2); box-shadow:none}

/* HERO */
.hero{padding:60px 24px 40px; text-align:center; background:linear-gradient(180deg, transparent, var(--surface)); position:relative; overflow:hidden}
.hero::before{content:''; position:absolute; inset:0; background:radial-gradient(circle at 50% 0%, rgba(255,180,0,0.1), transparent 70%); pointer-events:none}
.hero h1{font-family:var(--fancy); font-size:56px; margin:0 0 16px 0; line-height:1.1; background:linear-gradient(135deg,var(--accent),var(--accent-2),var(--accent)); background-size:200% 200%; -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; animation:gradientShift 5s ease infinite; font-weight:700}
@keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.hero p{color:var(--muted); margin-top:12px; font-size:18px; max-width:700px; margin-left:auto; margin-right:auto; line-height:1.6}
.hero-stats{display:flex; gap:32px; justify-content:center; margin-top:32px; flex-wrap:wrap}
.hero-stat{text-align:center}
.hero-stat-number{font-size:32px; font-weight:800; color:var(--accent); font-family:var(--ui)}
.hero-stat-label{font-size:13px; color:var(--muted); text-transform:uppercase; letter-spacing:1px; margin-top:4px}

/* CONTROLS */
.controls-wrapper{background:var(--surface); padding:24px; border-radius:16px; margin:0 24px 32px; box-shadow:var(--card-shadow); border:1px solid var(--border)}
.controls{display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-bottom:16px}
.controls input[type="search"], .controls select, .controls input[type="email"]{
  padding:12px 16px; border-radius:10px; border:1px solid var(--border); outline:none; min-width:180px; 
  background:var(--bg); color:var(--text); box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);
  transition:all .2s; font-family:var(--ui); font-size:14px; font-weight:500;
}
.controls input:focus, .controls select:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(255,180,0,0.1)}
.controls button{padding:12px 18px; border-radius:10px; border:none; cursor:pointer; background:var(--accent); color:#000; font-weight:700; transition:all .2s; font-size:14px; font-family:var(--ui); display:inline-flex; align-items:center; gap:6px}
.controls button:hover{transform:translateY(-2px); box-shadow:0 6px 20px rgba(255,180,0,0.3)}

.view-controls{display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; padding-top:16px; border-top:1px solid var(--border)}
.view-btn{padding:8px 14px; background:var(--bg); border:1px solid var(--border); border-radius:8px; cursor:pointer; transition:all .2s; font-size:13px; font-weight:600; color:var(--text)}
.view-btn:hover{background:var(--surface-2)}
.view-btn.active{background:var(--accent); color:#000; border-color:var(--accent)}

/* QUICK FILTERS */
.quick-filters{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin:0 24px 24px; padding:16px; background:var(--surface); border-radius:12px; border:1px solid var(--border)}
.quick-filter-tag{padding:8px 16px; background:var(--bg); border:1px solid var(--border); border-radius:20px; cursor:pointer; transition:all .2s; font-size:13px; font-weight:600; color:var(--text)}
.quick-filter-tag:hover{background:var(--surface-2); transform:translateY(-1px)}
.quick-filter-tag.active{background:var(--accent); color:#000; border-color:var(--accent)}

/* CONTAINER & GRID */
.container{max-width:1400px; margin:0 auto; padding:10px 24px 80px; animation:fadeIn .5s ease}
.gallery-grid{display:grid; gap:20px; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); transition:all .3s}
.gallery-grid.cols-2{grid-template-columns:repeat(2, 1fr)}
.gallery-grid.cols-3{grid-template-columns:repeat(3, 1fr)}
.gallery-grid.cols-4{grid-template-columns:repeat(4, 1fr)}
.gallery-grid.cols-5{grid-template-columns:repeat(5, 1fr)}
.gallery-grid.masonry{column-count:4; column-gap:20px; grid-template-columns:none}
.gallery-grid.masonry .card{break-inside:avoid; margin-bottom:20px; display:inline-block; width:100%}
.gallery-grid.list-view{grid-template-columns:1fr; gap:16px}

@media(max-width:1200px){.gallery-grid.masonry{column-count:3}}
@media(max-width:900px){.gallery-grid.masonry{column-count:2}}
@media(max-width:600px){.gallery-grid.masonry{column-count:1}}

.empty-state{text-align:center; padding:80px 20px; color:var(--muted); grid-column:1/-1}
.empty-state h3{font-family:var(--fancy); font-size:28px; margin-bottom:12px; color:var(--text)}
.empty-state p{font-size:16px; margin-top:8px}

/* CARD */
.card{position:relative; overflow:hidden; border-radius:16px; background:var(--surface); box-shadow:var(--card-shadow); transition:all .4s cubic-bezier(.2,.9,.3,1); border:1px solid var(--border); cursor:pointer}
.card:hover{transform:translateY(-8px) scale(1.02); box-shadow:0 20px 50px rgba(0,0,0,0.8); border-color:var(--accent)}
.card img{width:100%; height:auto; display:block; transition:transform .6s ease; aspect-ratio:16/10; object-fit:cover}
.card:hover img{transform:scale(1.08)}

.card.list-view{display:flex; flex-direction:row; align-items:center; gap:20px}
.card.list-view img{width:200px; height:120px; flex-shrink:0; border-radius:12px}
.card.list-view .card-content{flex:1; padding:20px}

.card-overlay{position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%); opacity:0; transition:opacity .3s; pointer-events:none}
.card:hover .card-overlay{opacity:1}

.card .meta{position:absolute; left:12px; top:12px; background:rgba(0,0,0,0.75); backdrop-filter:blur(10px); padding:6px 12px; border-radius:20px; font-size:12px; color:#fff; font-weight:600; display:flex; align-items:center; gap:6px; border:1px solid rgba(255,255,255,0.1)}
.card .featured-badge{position:absolute; right:12px; top:12px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); padding:6px 12px; border-radius:20px; font-size:11px; color:#000; font-weight:700; text-transform:uppercase; letter-spacing:0.5px}

.card .actions{position:absolute; right:12px; bottom:12px; display:flex; gap:8px; opacity:0; transform:translateY(10px); transition:all .3s}
.card:hover .actions{opacity:1; transform:translateY(0)}
.icon-btn{background:rgba(0,0,0,0.75); backdrop-filter:blur(10px); color:#fff; border:1px solid rgba(255,255,255,0.2); padding:10px 12px; border-radius:10px; cursor:pointer; font-weight:600; transition:all .2s; text-decoration:none; display:inline-flex; align-items:center; gap:4px; font-size:13px}
.icon-btn:hover{transform:translateY(-3px); background:rgba(0,0,0,0.9); box-shadow:0 8px 20px rgba(0,0,0,0.5)}

.card .info-overlay{position:absolute; left:12px; bottom:12px; opacity:0; transform:translateY(10px); transition:all .3s; color:#fff; max-width:calc(100% - 140px)}
.card:hover .info-overlay{opacity:1; transform:translateY(0)}
.info-overlay h3{font-size:16px; font-weight:700; margin-bottom:4px; text-shadow:0 2px 8px rgba(0,0,0,0.8)}
.info-overlay .tags{font-size:11px; opacity:0.8}

.fav{position:absolute; right:12px; top:12px; background:rgba(0,0,0,0.75); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.2); font-size:20px; color:#fff; cursor:pointer; padding:8px 10px; border-radius:10px; transition:all .2s; z-index:10}
.fav:hover{transform:scale(1.15); background:rgba(0,0,0,0.9)}
.fav.active{color:#ff6a88}

/* COLOR PALETTE */
.color-palette{display:flex; gap:4px; margin-top:8px; position:absolute; left:12px; bottom:50px; opacity:0; transition:all .3s}
.card:hover .color-palette{opacity:1}
.color-swatch{width:20px; height:20px; border-radius:50%; border:2px solid rgba(255,255,255,0.8); box-shadow:0 2px 8px rgba(0,0,0,0.3)}

/* LIGHTBOX */
.lightbox{position:fixed; inset:0; display:none; justify-content:center; align-items:center; z-index:9999; background:rgba(0,0,0,0.95); backdrop-filter:blur(20px); padding:20px; animation:fadeIn .3s}
.lightbox.show{display:flex}
.lightbox-inner{display:flex; gap:24px; align-items:center; max-width:95%; max-height:90%; flex-direction:column; animation:fadeIn .4s}

.lightbox-main{display:flex; gap:24px; align-items:center; width:100%}
.lightbox img{max-width:90vw; max-height:70vh; border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,0.8); border:1px solid var(--border)}

.lb-meta{max-width:600px; color:var(--muted); font-size:14px; background:var(--surface); padding:24px; border-radius:16px; width:100%; border:1px solid var(--border)}
.lb-meta h3{margin:0 0 8px 0; font-family:var(--fancy); font-size:24px; color:var(--text); font-weight:700}
.lb-meta .meta-row{display:flex; justify-content:space-between; align-items:center; margin:12px 0; padding:8px 0; border-bottom:1px solid var(--border)}
.lb-meta .tags{display:flex; gap:6px; flex-wrap:wrap; margin-top:12px}
.lb-tag{background:var(--bg); padding:6px 12px; border-radius:20px; font-size:12px; font-weight:600; border:1px solid var(--border)}

.download-controls{margin-top:20px; padding-top:20px; border-top:1px solid var(--border)}
.download-controls label{font-size:13px; color:var(--muted); font-weight:600; display:block; margin-bottom:8px}
.download-controls select{width:100%; padding:10px; border-radius:10px; background:var(--bg); color:var(--text); border:1px solid var(--border); font-family:var(--ui); font-size:14px; font-weight:500; margin-bottom:12px}
.download-controls .btn-group{display:flex; gap:10px; flex-wrap:wrap}
.download-controls .icon-btn{flex:1; justify-content:center; background:var(--accent); color:#000}
.download-controls .icon-btn.secondary{background:var(--surface-2); color:var(--text); border:1px solid var(--border)}

.lightbox-nav{position:absolute; top:50%; transform:translateY(-50%); width:50px; height:50px; background:rgba(0,0,0,0.75); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all .2s; color:#fff; font-size:24px}
.lightbox-nav:hover{background:rgba(0,0,0,0.9); transform:translateY(-50%) scale(1.1)}
.lightbox-nav.prev{left:20px}
.lightbox-nav.next{right:20px}

#lightboxClose{position:absolute; right:20px; top:20px; background:rgba(0,0,0,0.75); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.2); color:#fff; font-size:24px; cursor:pointer; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:all .2s}
#lightboxClose:hover{background:rgba(0,0,0,0.9); transform:scale(1.1)}

@media(min-width:768px){
  .lightbox-inner{flex-direction:row}
  .lightbox img{max-width:calc(100vw - 450px); max-height:85vh}
  .lb-meta{max-width:360px}
}

/* FAVORITES PANEL */
.fav-panel{position:fixed; right:-360px; top:0; width:360px; height:100vh; overflow:auto; background:var(--surface); padding:24px; box-shadow:-5px 0 30px rgba(0,0,0,0.5); z-index:997; transition:right .3s; border-left:1px solid var(--border)}
.fav-panel.show{right:0}
.fav-panel h4{margin:0 0 20px 0; font-family:var(--fancy); font-size:22px; display:flex; justify-content:space-between; align-items:center}
.fav-panel-close{background:var(--bg); border:1px solid var(--border); color:var(--text); padding:6px 10px; border-radius:8px; cursor:pointer; font-size:18px}

.fav-item{display:flex; gap:12px; margin-bottom:16px; padding:12px; background:var(--bg); border-radius:12px; border:1px solid var(--border); transition:all .2s}
.fav-item:hover{background:var(--surface-2); transform:translateX(-4px)}
.fav-item img{width:80px; height:50px; object-fit:cover; border-radius:8px; flex-shrink:0}
.fav-item-info{flex:1; min-width:0}
.fav-item-title{font-weight:700; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.fav-item-cat{color:var(--muted); font-size:12px; margin-top:2px}
.fav-item-actions{display:flex; flex-direction:column; gap:6px}
.fav-item-actions button{padding:6px 10px; font-size:11px; background:var(--surface-2); border:1px solid var(--border); color:var(--text); border-radius:6px; cursor:pointer; transition:all .2s; font-weight:600}
.fav-item-actions button:hover{background:var(--accent); color:#000; border-color:var(--accent)}

/* COLLECTIONS MODAL */
.modal{position:fixed; inset:0; background:rgba(0,0,0,0.9); backdrop-filter:blur(10px); z-index:9998; display:none; align-items:center; justify-content:center; padding:20px; animation:fadeIn .3s}
.modal.show{display:flex}
.modal-content{background:var(--surface); border-radius:16px; padding:32px; max-width:500px; width:100%; max-height:80vh; overflow:auto; border:1px solid var(--border); animation:slideDown .3s}
.modal-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:24px}
.modal-header h3{font-family:var(--fancy); font-size:24px; margin:0}
.modal-close{background:var(--bg); border:1px solid var(--border); color:var(--text); padding:8px 12px; border-radius:8px; cursor:pointer; font-size:18px; transition:all .2s}
.modal-close:hover{background:var(--surface-2)}

.collection-grid{display:grid; gap:12px; margin-top:16px}
.collection-item{padding:16px; background:var(--bg); border:1px solid var(--border); border-radius:12px; cursor:pointer; transition:all .2s; display:flex; justify-content:space-between; align-items:center}
.collection-item:hover{background:var(--surface-2); transform:translateX(4px)}
.collection-item.active{border-color:var(--accent); background:rgba(255,180,0,0.1)}
.collection-name{font-weight:700; font-size:15px}
.collection-count{color:var(--muted); font-size:13px; margin-top:4px}

/* CONTROLS BOTTOM */
.controls-bottom{display:flex; justify-content:center; gap:12px; margin-top:32px; flex-wrap:wrap}
.load-more{padding:12px 24px; border-radius:10px; border:1px solid var(--border); background:var(--surface); color:var(--text); cursor:pointer; font-weight:700; transition:all .2s; font-family:var(--ui); font-size:14px}
.load-more:hover{background:var(--accent); color:#000; border-color:var(--accent); transform:translateY(-2px)}

/* BACK TO TOP */
#backToTop{position:fixed; right:24px; bottom:24px; padding:14px 16px; border-radius:50%; background:var(--accent); color:#000; border:none; cursor:pointer; display:none; z-index:996; font-weight:700; font-size:20px; box-shadow:0 8px 24px rgba(0,0,0,0.3); transition:all .2s; width:56px; height:56px}
#backToTop:hover{transform:translateY(-4px) scale(1.05); box-shadow:0 12px 32px rgba(255,180,0,0.4)}

/* TOAST */
.toast{position:fixed; left:50%; transform:translateX(-50%); bottom:30px; background:var(--surface); padding:14px 24px; border-radius:12px; z-index:99999; color:var(--text); box-shadow:var(--card-shadow); border:1px solid var(--border); animation:slideUp .3s; display:flex; align-items:center; gap:10px; font-weight:600}
.toast.success{border-color:var(--success); background:rgba(74,222,128,0.1)}
.toast.error{border-color:var(--error); background:rgba(239,68,68,0.1)}

/* ERROR BANNER */
.error-banner{background:var(--error); color:#fff; padding:12px 24px; text-align:center; font-weight:600; display:none; animation:slideDown .3s}
.error-banner.show{display:block}

/* KEYBOARD SHORTCUTS */
.shortcuts-modal .shortcut-item{display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid var(--border)}
.shortcut-key{background:var(--bg); padding:6px 12px; border-radius:6px; font-family:monospace; font-weight:700; border:1px solid var(--border)}

/* WALLPAPER OF THE DAY */
.wotd-banner{background:linear-gradient(135deg, var(--accent), var(--accent-2)); padding:32px; border-radius:16px; margin:0 24px 24px; color:#000; display:flex; gap:24px; align-items:center; box-shadow:var(--card-shadow); overflow:hidden; position:relative}
.wotd-banner::before{content:''; position:absolute; inset:0; background:url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(0,0,0,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>'); opacity:0.3}
.wotd-content{flex:1; position:relative; z-index:1}
.wotd-label{font-size:12px; font-weight:800; text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; opacity:0.8}
.wotd-title{font-family:var(--fancy); font-size:28px; font-weight:700; margin-bottom:8px}
.wotd-desc{font-size:14px; opacity:0.9; margin-bottom:16px}
.wotd-btn{background:#000; color:#fff; padding:12px 24px; border:none; border-radius:10px; cursor:pointer; font-weight:700; transition:all .2s}
.wotd-btn:hover{transform:translateY(-2px); box-shadow:0 8px 20px rgba(0,0,0,0.3)}
.wotd-image{width:200px; height:120px; border-radius:12px; object-fit:cover; box-shadow:0 8px 24px rgba(0,0,0,0.3); position:relative; z-index:1}

/* TRENDING SECTION */
.section-header{display:flex; justify-content:space-between; align-items:center; margin:0 24px 20px; padding-bottom:12px; border-bottom:2px solid var(--border)}
.section-title{font-family:var(--fancy); font-size:32px; font-weight:700; margin:0}
.section-link{color:var(--accent); font-weight:600; text-decoration:none; transition:all .2s}
.section-link:hover{transform:translateX(4px)}

/* STATS CARDS */
.stats-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin:0 24px 32px}
.stat-card{background:var(--surface); padding:24px; border-radius:16px; border:1px solid var(--border); box-shadow:var(--card-shadow); transition:all .3s}
.stat-card:hover{transform:translateY(-4px); border-color:var(--accent)}
.stat-card-icon{width:50px; height:50px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px; margin-bottom:16px}
.stat-card-number{font-size:36px; font-weight:800; color:var(--accent); font-family:var(--ui); margin-bottom:8px}
.stat-card-label{color:var(--muted); font-size:14px; font-weight:600}

/* SIMILAR WALLPAPERS */
.similar-section{margin-top:32px; padding-top:32px; border-top:1px solid var(--border)}
.similar-grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:12px}
.similar-item{border-radius:12px; overflow:hidden; cursor:pointer; transition:all .3s; border:2px solid transparent}
.similar-item:hover{transform:scale(1.05); border-color:var(--accent)}
.similar-item img{width:100%; height:100px; object-fit:cover; display:block}

/* RESPONSIVE */
@media(max-width:1024px){
  .gallery-grid.cols-5{grid-template-columns:repeat(4,1fr)}
  .wotd-banner{flex-direction:column; text-align:center}
  .wotd-image{width:100%; height:200px}
}

@media(max-width:768px){
  .hero h1{font-size:36px}
  .hero-stats{gap:20px}
  .controls-wrapper{margin:0 16px 24px; padding:16px}
  .controls{gap:8px}
  .controls input,.controls select{min-width:140px; font-size:13px}
  .gallery-grid{gap:16px; padding:0 8px}
  .gallery-grid.cols-3,.gallery-grid.cols-4,.gallery-grid.cols-5{grid-template-columns:repeat(2,1fr)}
  .fav-panel{width:100%; right:-100%}
  header{padding:10px 16px; flex-wrap:wrap}
  .header-left{width:100%; justify-content:space-between}
  nav{order:3; width:100%; justify-content:center; margin-top:8px; gap:8px}
  .lightbox-nav{display:none}
  .lb-meta{max-width:100%}
  .section-header{margin:0 16px 16px; flex-direction:column; gap:12px; align-items:flex-start}
  .stats-grid{grid-template-columns:1fr; margin:0 16px 24px}
  .quick-filters{margin:0 16px 16px}
  .wotd-banner{margin:0 16px 24px; padding:20px}
}

@media(max-width:480px){
  .hero h1{font-size:28px}
  .hero p{font-size:16px}
  .controls input,.controls select,.controls button{width:100%}
  .gallery-grid.cols-2{grid-template-columns:1fr}
}
